plugins {
  id "idea"
  id "java"
  id "com.diffplug.spotless" version "5.12.4"
  id "com.google.cloud.tools.jib" version "3.0.0"
}

repositories {
  mavenCentral()
}

group "com.sdase.k8s.operator.mongodb"

idea.module.inheritOutputDirs = true

spotless {
  java { googleJavaFormat('1.9') }
  enforceCheck = false
}

jib {
  container.ports = []
  container.args = []
  from.image = 'quay.io/sdase/openjdk-runtime:11-hotspot-distroless'
  container.user = 10001
  to.image = "$rootProject.name:latest"
}

test {
  useJUnitPlatform()
  testLogging {
    events "passed", "skipped", "failed"
  }
}

project.ext {
  fabric8Version = "5.0.1"
  mongoDbDriverVersion = "4.2.3"
  slf4jVersion = "1.7.30"
  operatorFrameworkVersion = "1.9.0"
}

dependencies {

  implementation "io.javaoperatorsdk:operator-framework:${operatorFrameworkVersion}"
  annotationProcessor "io.javaoperatorsdk:operator-framework:${operatorFrameworkVersion}"

  implementation "io.fabric8:kubernetes-client:${fabric8Version}"
  implementation "org.mongodb:mongodb-driver-sync:${mongoDbDriverVersion}"
  implementation "org.slf4j:slf4j-simple:${slf4jVersion}"
  implementation "org.apache.commons:commons-lang3:3.12.0"
  implementation "org.hibernate.validator:hibernate-validator:7.0.0.Final"
  implementation "jakarta.el:jakarta.el-api:4.0.0"


  testImplementation platform("org.junit:junit-bom:5.7.2")
  testImplementation "org.junit.jupiter:junit-jupiter"
  testImplementation "org.junit-pioneer:junit-pioneer:1.4.2"
  testImplementation "org.assertj:assertj-core:3.20.1"
  testImplementation "de.flapdoodle.embed:de.flapdoodle.embed.mongo:3.0.0"
  testImplementation "org.mongodb:mongodb-driver-legacy:${mongoDbDriverVersion}"
}

wrapper { gradleVersion = '6.5' }

version = System.getenv('SEMANTIC_VERSION')
