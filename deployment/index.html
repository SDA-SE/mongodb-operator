
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../argocd/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.13">
    
    
      
        <title>Deployment - MongoDB Operator</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e359304.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#deployment-of-the-mongodb-operator" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="MongoDB Operator" class="md-header__button md-logo" aria-label="MongoDB Operator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MongoDB Operator
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Deployment
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="MongoDB Operator" class="md-nav__button md-logo" aria-label="MongoDB Operator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    MongoDB Operator
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MongoDB Operator
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Deployment
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Deployment
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mongodb-operator-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      MongoDB Operator Requirements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-with-kustomize" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment with Kustomize
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manual-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      Manual Deployment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Manual Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Kubernetes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-account" class="md-nav__link">
    <span class="md-ellipsis">
      Service Account
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-resource-definition" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Resource Definition
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database" class="md-nav__link">
    <span class="md-ellipsis">
      Database
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mongodb-operator-image" class="md-nav__link">
    <span class="md-ellipsis">
      MongoDB Operator Image
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MongoDB Operator Image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base-image" class="md-nav__link">
    <span class="md-ellipsis">
      Base Image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Environment Variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Environment Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#java" class="md-nav__link">
    <span class="md-ellipsis">
      Java
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mongodb" class="md-nav__link">
    <span class="md-ellipsis">
      MongoDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    <span class="md-ellipsis">
      Logging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      Endpoints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../argocd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ArgoCD
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../process/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How the MongoDB Operator works
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mongodb-operator-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      MongoDB Operator Requirements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-with-kustomize" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment with Kustomize
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manual-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      Manual Deployment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Manual Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Kubernetes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-account" class="md-nav__link">
    <span class="md-ellipsis">
      Service Account
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-resource-definition" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Resource Definition
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database" class="md-nav__link">
    <span class="md-ellipsis">
      Database
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mongodb-operator-image" class="md-nav__link">
    <span class="md-ellipsis">
      MongoDB Operator Image
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MongoDB Operator Image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base-image" class="md-nav__link">
    <span class="md-ellipsis">
      Base Image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Environment Variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Environment Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#java" class="md-nav__link">
    <span class="md-ellipsis">
      Java
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mongodb" class="md-nav__link">
    <span class="md-ellipsis">
      MongoDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    <span class="md-ellipsis">
      Logging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      Endpoints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="deployment-of-the-mongodb-operator">Deployment of the MongoDB Operator<a class="headerlink" href="#deployment-of-the-mongodb-operator" title="Permanent link">&para;</a></h1>
<h2 id="mongodb-operator-requirements">MongoDB Operator Requirements<a class="headerlink" href="#mongodb-operator-requirements" title="Permanent link">&para;</a></h2>
<p>To function properly, some requirements in the Kubernetes deployment must be met, and a MongoDB
database instance dedicated to the Kubernetes cluster must be set up.</p>
<p>The MongoDB Operator expects a strict 1 to 1 relation of Kubernetes Cluster and MongoDB database
instance.
Exactly one MongoDB Operator replica must be deployed in one Kubernetes Cluster watching all
namespaces.
This MongoDB Operator is the only one managing users of the MongoDB database instance dedicated to
the Kubernetes cluster.
Database names and usernames are created based on namespace name and MongoDB resource name to avoid
naming conflicts.
A database instance managed by multiple MongoDB Operators for multiple clusters would cause name
conflicts and access to the same database from multiple clusters.</p>
<h2 id="deployment-with-kustomize">Deployment with Kustomize<a class="headerlink" href="#deployment-with-kustomize" title="Permanent link">&para;</a></h2>
<p>The easiest way to deploy the MongoDB Operator is to use the remote base with <a href="https://kustomize.io/">Kustomize</a>.
The <code>kustomization.yaml</code> must include the versioned remote base and provide a secret for the MongoDB
connection with a user granting <a href="#database">the required privileges</a>.
The remote bases <a href="#logging">enable Json logging</a> by default.</p>
<div class="admonition example">
<p class="admonition-title">Deployment with Kustomize</p>
<p>In default namespace <code>mongodb-operator</code>:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Namespace mongodb-operator is created by the remote base</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
<span class="nt">resources</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/SDA-SE/mongodb-operator//kustomize/release?ref=1.0.27</span>
<span class="nt">secretGenerator</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodb-operator</span>
<span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodb-operator</span>
<span class="w">    </span><span class="nt">literals</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodbConnectionString=mongodb://user:s3cr3t@mongodb.mongodb:27017</span>
</code></pre></div></td></tr></table></div>
<p>In custom namespace:
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># kustomization.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
<span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">custom-namespace</span>
<span class="nt">resources</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">custom-namespace-ns.yaml</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/SDA-SE/mongodb-operator//kustomize/release/no-namespace?ref=1.0.27</span>
<span class="nt">secretGenerator</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodb-operator</span>
<span class="w">    </span><span class="nt">literals</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodbConnectionString=mongodb://user:s3cr3t@mongodb.mongodb:27017</span>

<span class="c1"># custom-namespace-ns.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">custom-namespace</span>
</code></pre></div></td></tr></table></div></p>
<div class="admonition warning">
<p class="admonition-title">Plain Secrets</p>
<p>Do not use plain secrets in GitOps repositories!
Consider tools like <a href="https://sealed-secrets.netlify.app/">Sealed Secrets</a> or
<a href="https://external-secrets.io/">External Secrets</a> to provide secrets for GitOps deployments
securely.</p>
</div>
<details class="info">
<summary>Don't reference the default branch</summary>
<p>Never use a remote base from the default branch (without <code>?ref=x.y.z</code>).
Due to the release process, it is possible that the image referenced in the default branch
does not exist yet.
Deployments will fail.
Also breaking releases may be deployed unexpectitly when not referencing a defined tag.</p>
</details>
<details class="info">
<summary>TLS connections</summary>
<p>To connect to MongoDB or DocumentDB using TLS, add the query param <code>tls=true</code> to the secret
<code>MONGODB_CONNECTION_STRING</code> and reference the CA in PEM format in a <code>configMapGenerator</code>
like this:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">configMapGenerator</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodb-operator-ca-pem</span>
<span class="w">    </span><span class="nt">behavior</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">merge</span>
<span class="w">    </span><span class="nt">files</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ca-of-my-mongo-server.pem</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
<h2 id="manual-deployment">Manual Deployment<a class="headerlink" href="#manual-deployment" title="Permanent link">&para;</a></h2>
<h3 id="kubernetes">Kubernetes<a class="headerlink" href="#kubernetes" title="Permanent link">&para;</a></h3>
<p>An <a href="https://github.com/SDA-SE/mongodb-operator/tree/master/kustomize/bases/operator">example deployment of the MongoDB Operator</a>
that covers the following requirements is available in the GitHub Repository of the MongoDB
Operator.</p>
<h4 id="service-account">Service Account<a class="headerlink" href="#service-account" title="Permanent link">&para;</a></h4>
<p>The MongoDB Operator requires a <code>ServiceAccount</code> with some privileges for the Kubernetes API from a
<code>ClusterRole</code>:</p>
<ul>
<li>For the resource <code>mongodbs</code> the following verbs are required:<ul>
<li><code>watch</code></li>
<li><code>list</code></li>
<li><code>get</code></li>
<li><code>update</code></li>
</ul>
</li>
<li>For the resource <code>mongodbs/status</code> the following verbs are required:<ul>
<li><code>watch</code></li>
<li><code>list</code></li>
<li><code>get</code></li>
<li><code>update</code></li>
</ul>
</li>
<li>For the resource <code>secrets</code> the following verbs are required:<ul>
<li><code>create</code></li>
<li><code>update</code></li>
</ul>
</li>
<li>For the resource <code>customresourcedefinitions</code> with the resource name
  <code>mongodbs.persistence.sda-se.com</code> the following verbs are required:<ul>
<li><code>get</code></li>
</ul>
</li>
</ul>
<h4 id="custom-resource-definition">Custom Resource Definition<a class="headerlink" href="#custom-resource-definition" title="Permanent link">&para;</a></h4>
<p>The <a href="https://github.com/SDA-SE/mongodb-operator/tree/master/kustomize/bases/operator/mongodbs-crd.yaml">CRD <code>mongodbs</code></a>
must be applied.</p>
<h3 id="database">Database<a class="headerlink" href="#database" title="Permanent link">&para;</a></h3>
<p>A MongoDB database instance or an AWS DocumentDB cluster must be set up separately from the
deployment of the MongoDB Operator.</p>
<p>A user for MongoDB Operator must be created.</p>
<p>The user of the MongoDB Operator must be granted
<a href="https://docs.mongodb.com/v4.4/reference/built-in-roles/#mongodb-authrole-userAdminAnyDatabase"><code>userAdminAnyDatabase</code></a>
to function properly.</p>
<p><a href="https://docs.mongodb.com/v4.4/reference/built-in-roles/#mongodb-authrole-dbAdminAnyDatabase"><code>dbAdminAnyDatabase</code></a>
is needed to support <code>spec.database.pruneAfterDelete: true</code> of the MongoDB custom resource.
<code>pruneAfterDelete</code> is suggested for develop and test environments only where pull request or
temporary test deployments could create a big amount of temporary used databases.</p>
<h2 id="mongodb-operator-image">MongoDB Operator Image<a class="headerlink" href="#mongodb-operator-image" title="Permanent link">&para;</a></h2>
<p>The image is hosted at <a href="https://quay.io/repository/sdase/mongodb-operator">quay.io/sdase/mongodb-operator</a>.</p>
<h3 id="base-image">Base Image<a class="headerlink" href="#base-image" title="Permanent link">&para;</a></h3>
<p>This container is based on the distroless <a href="https://console.cloud.google.com/gcr/images/distroless/GLOBAL/java21-debian12:nonroot/details">Java image by Google</a>.
The base image provides both manual and automatic ways to configure memory limits of the JVM.</p>
<h3 id="environment-variables">Environment Variables<a class="headerlink" href="#environment-variables" title="Permanent link">&para;</a></h3>
<p>The following environment variables can be used to configure the Docker container:</p>
<h4 id="java">Java<a class="headerlink" href="#java" title="Permanent link">&para;</a></h4>
<ul>
<li><code>JAVA_TOOL_OPTIONS</code> <em>string</em><ul>
<li>Set options for the JVM.
  If Java options are set, you will find <em>Picked up JAVA_TOOL_OPTIONS: "-Xmx340m"</em> or similar in
  the log.</li>
<li>Example: <code>-Xmx340m</code> to set the max heap size</li>
</ul>
</li>
</ul>
<h4 id="mongodb">MongoDB<a class="headerlink" href="#mongodb" title="Permanent link">&para;</a></h4>
<p>When connecting to the MongoDB, the configured hosts are checked.
If any ends with <code>.docdb.amazonaws.com</code>, a connection to AWS DocumentDB is assumed, and the behavior
slightly changes.
While users for requested databases are created in the database when using MongoDB, all users will
be created in the <code>admin</code> database when AWS DocumentDB is used.</p>
<ul>
<li><code>MONGODB_CONNECTION_STRING</code> <em>string</em><ul>
<li>The connection String that covers all configuration to access the MongoDB database.</li>
<li>Example: <code>mongodb://username:password@mongodb.mongodb:27017</code></li>
</ul>
</li>
<li><code>TRUSTED_CERTIFICATES_DIR</code><ul>
<li>Directory in the container where CA certificates or certificate bundles in PEM format can be
  mounted. These certificates are used to verify SSL connections to the database.
  The configuration is ignored if no files are mounted.
  To consider, the mounted certifaces, the <code>MONGODB_CONNECTION_STRING</code> must contain the query
  parameter <code>tls=true</code>.
  Startup will fail if the directory is not readable.</li>
<li>Default: <code>/var/trust/certificates</code></li>
</ul>
</li>
</ul>
<h4 id="logging">Logging<a class="headerlink" href="#logging" title="Permanent link">&para;</a></h4>
<ul>
<li><code>ENABLE_JSON_LOGGING</code> <em>boolean</em><ul>
<li>Enables logging as Json if <code>true</code> (case-insensitive).
  Configuration errors are never logged as Json.
  Each log will be one line of Json, containing the keys:<ul>
<li><code>level</code>: <code>"INFO"</code>, <code>"WARN"</code> or <code>"ERROR"</code>.</li>
<li><code>message</code>: The log message.</li>
<li><code>exception</code>: The exception, if any.</li>
<li><code>mdc</code>: Object with additional key-value information, if any.</li>
</ul>
</li>
<li>Default: <em>none</em>, effectively <code>false</code></li>
</ul>
</li>
</ul>
<h3 id="endpoints">Endpoints<a class="headerlink" href="#endpoints" title="Permanent link">&para;</a></h3>
<p>The image exposes port <code>8081</code> for monitoring purposes.</p>
<p>It provides the following endpoints:</p>
<ul>
<li>Readiness: <code>http://{serviceUrl}:8081/health/readiness</code></li>
<li>Liveness: <code>http://{serviceUrl}:8081/health/liveness</code></li>
<li>
<p>Metrics in prometheus format: <code>http://{serviceUrl}:8081/metrics/prometheus</code></p>
<p>The provided metrics should be compatible with <a href="https://grafana.com/grafana/dashboards/4701-jvm-micrometer/">the JVM Micrometer Dashboard</a></p>
</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: MongoDB Operator">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                MongoDB Operator
              </div>
            </div>
          </a>
        
        
          
          <a href="../argocd/" class="md-footer__link md-footer__link--next" aria-label="Next: ArgoCD">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                ArgoCD
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.footer", "content.action.edit"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8d2eff1.min.js"></script>
      
        <script src="../search/main.js"></script>
      
    
  </body>
</html>